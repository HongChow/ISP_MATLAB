div_table1 = [131072,104858,87381,74898,65536,58254,52429,47663,43691,40330,37449,34953,32768,30840,29127,27594,26214,24966,23831,22795,21845,20972,20165,19418,18725,18079,17476,16913,16384,15888,15420,14980,14564,14170,13797,13443,13107,12788,12483,12193,11916,11651,11398,11155,10923,10700,10486,10280,10082,9892,9709,9533,9362,9198,9039,8886,8738,8595,8456,8322,8192,8066,7944,7825,7710,7598,7490,7384,7282,7182,7085,6991,6899,6809,6722,6637,6554,6473,6394,6317,6242,6168,6096,6026,5958,5891,5825,5761,5699,5638,5578,5519,5461,5405,5350,5296,5243,5191,5140,5090,5041,4993,4946,4900,4855,4810,4766,4723,4681,4640,4599,4559,4520,4481,4443,4406,4369,4333,4297,4263,4228,4194,4161,4128,4096,4064,4033,4002,3972,3942,3913,3884,3855,3827,3799,3772,3745,3718,3692,3666,3641,3616,3591,3567,3542,3519,3495,3472,3449,3427,3404,3383,3361,3339,3318,3297,3277,3256,3236,3216,3197,3178,3158,3139,3121,3102,3084,3066,3048,3031,3013,2996,2979,2962,2945,2929,2913,2897,2881,2865,2849,2834,2819,2804,2789,2774,2759,2745,2731,2717,2703,2689,2675,2661,2648,2635,2621,2608,2595,2583,2570,2558,2545,2533,2521,2509,2497,2485,2473,2461,2450,2439,2427,2416,2405,2394,2383,2372,2362,2351,2341,2330,2320,2310,2300,2289,2280,2270,2260,2250,2241,2231,2222,2212,2203,2194,2185,2175,2166,2158,2149,2140,2131,2123,2114,2106,2097,2089,2081,2072,2064,2056,2048];
x_all = [256,335,427,512,669,833,999,1425,2000,3000,4040,4423,5844,7854,10181,17190,26887];
y_all = [2048,1565,1228,1024,784,629,525,368,262,175,130,119,90,67,51,30,19];

[~,N_picese] = size(x_all);
N_picese = N_picese-1;
K_picese = zeros(1,N_picese);
B_picese = zeros(1,N_picese);
for index=1:N_picese
    K_picese(index) = (y_all(index+1)-y_all(index))/(x_all(index+1)-x_all(index));
end

for index=1:N_picese
    B_picese(index) = round(y_all(index)-K_picese(index)*x_all(index));
end

%%
int_K_picese = round((-K_picese)*(2^9));
int_B_picese = round(B_picese);
clear K_picese B_picese;

y = zeros(1,65536);
for x=4:256
    y(x)=div_table1(x-3);        
end
for index = 1:N_picese
    for x = x_all(index):x_all(index+1)
        y(x) = int_B_picese(index)-bitshift((int_K_picese(index)*x+2^8),-9);    
    end
end

Cx_all = [26887,28340,29960,31777,33826,36158,38837,41944,45591,49933,55189,61681];
Cy_all = [19,18,17,16,15,14,13,12,11,10,9,8];
CN_all = 11;
for index = 1:CN_all
    for x = Cx_all(index):Cx_all(index+1)-1
        y(x) = Cy_all(index);    
    end
end
for x = 61681:65536
    y(x) = Cy_all(end);
end
%%
y_ = y;
x_ = 4:65536;
figure(7);plot(x_,y_(4:end),'red');hold on;
x0 = 4:65536;
y0 = round(4*2^17*(1./x0));
plot(x0,y0,'blue');
% figure(2);plot(x0,y0,'blue');hold on;plot(x,y(4:end),'red');
%%
x_all = [256,335,427,512,669,833,999,1425,2000,3000,4040,4423,5844,7854,10181,17190];
y_all = [2048,1565,1228,1024,784,629,525,368,262,175,130,119,90,67,51,30,19];


x1_data = x_all(1):x_all(1+1);
y1_data = 4*2^17*(1./x1_data);


x2_data = x_all(2):x_all(2+1);
y2_data = 4*2^17*(1./x2_data);


x3_data = x_all(3):x_all(3+1);
y3_data = 4*2^17*(1./x3_data);


x4_data = x_all(4):x_all(4+1);
y4_data = 4*2^17*(1./x4_data);


x5_data = x_all(5):x_all(5+1);
y5_data = 4*2^17*(1./x5_data);


x6_data = x_all(6):x_all(6+1);
y6_data = 4*2^17*(1./x6_data);


x7_data = x_all(7):x_all(7+1);
y7_data = 4*2^17*(1./x7_data);


x8_data = x_all(8):x_all(8+1);
y8_data = 4*2^17*(1./x8_data);


x9_data = x_all(9):x_all(9+1);
y9_data = 4*2^17*(1./x9_data);


x10_data = x_all(10):x_all(10+1);
y10_data = 4*2^17*(1./x10_data);


x11_data = x_all(11):x_all(11+1);
y11_data = 4*2^17*(1./x11_data);


x12_data = x_all(12):x_all(12+1);
y12_data = 4*2^17*(1./x12_data);

x13_data = x_all(13):x_all(13+1);
y13_data = 4*2^17*(1./x13_data);


x14_data = x_all(14):x_all(14+1);
y14_data = 4*2^17*(1./x14_data);


x15_data = x_all(15):x_all(15+1);
y15_data = 4*2^17*(1./x15_data);
%%
x_all_linear = [17191,18403,19615,20827,22039, 23251,24463,25675,26887];
x16_data = x_all_linear(1):x_all_linear(1+1);
y16_data = 4*2^17*(1./x16_data);

x17_data = x_all_linear(2):x_all_linear(2+1);
y17_data = 4*2^17*(1./x17_data);

x18_data = x_all_linear(3):x_all_linear(3+1);
y18_data = 4*2^17*(1./x18_data);

x19_data = x_all_linear(4):x_all_linear(4+1);
y19_data = 4*2^17*(1./x19_data);

x20_data = x_all_linear(5):x_all_linear(5+1);
y20_data = 4*2^17*(1./x20_data);

x21_data = x_all_linear(6):x_all_linear(6+1);
y21_data = 4*2^17*(1./x21_data);

x22_data = x_all_linear(7):x_all_linear(7+1);
y22_data = 4*2^17*(1./x22_data);

x23_data = x_all_linear(8):x_all_linear(8+1);
y23_data = 4*2^17*(1./x23_data);
%%
p11 = 0.02064;    p12 = -18.27;  p13 = 5371;
p21 = 0.009602;   p22 = -10.96;  p23 = 4158;
p31 = 0.005103;   p32 = -7.182;  p33 = 3364;
p41 = 0.002586;   p42 = -4.574;  p43 = 2687;
p51 = 0.001251;   p52 = -2.815;  p53 = 2107;
p61 = 0.000687;   p62 = -1.887;  p63 = 1724; % 2^16; 
p71 = 0.0003047;  p72 = -1.102;  p73 = 1321 ;
p81 = 0.000107;   p82 = -0.5483; p83 = 931.3;
p91 = 3.475e-05;  p92 = -0.2597; p93 = 641.8;
pa1 = 1.225e-05;  pa2 = -0.1291 ;pa3 = 451.7;
pb1 = 6.932e-06;  pb2 = -0.08798;pb3 = 372.1; % 2^22
pc1 = 3.94e-06;   pc2 = -0.06058;pc3 = 309.3; % 2^23
pd1 = 1.663e-06;  pd2 = -0.0341 ;pd3 = 232.1; % 2^22
pe1 = 7.254e-07;  pe2 = -0.01959;pe3 = 175.9; 
pf1 = 2.167e-07;  pf2 = -0.008846;pf3 = 118.8;
%%
k1 = -0.001656;
b1 =  58.95;
k2 = -0.001452;
b2 = 55.19;
k3 = -0.001283;
b3 = 51.88;
k4 = -0.001142;
b4 = 48.94;
k5 = -0.001023;
b5 = 46.32;
k6 = -0.0009215;
b6 = 43.97;
k7 = -0.0008345;
b7 = 41.84;
k8 = -0.0007593;
b8 = 39.91;



%%
p11 = 169;       % 13                 
p12 = -73;       % 2
p13 = 371;    

p21 = 2517;         % 18 
p22 = -1403;     % 7
p23 = 4158;

p31 = 42807;     % 23
p32 = -3677;     % 9
p33 = 3364;

p41 = 339;       % 17
p42 = -18735;    % 12
p43 = 2687;

p51 = 41;        % 15
p52 = -90;       % 5   
p53 = 2107;

p61 = 90;        % 17
p62 = -483;      % 8
p63 = 1724;

p71 = 639;       % 21
p72 = -282;      % 8
p73 = 1321 ;     

p81 = 14;        % 17
p82 = -35;       % 6
p83 = 931;       %

p91 = 583;       % 24
p92 = -266;      % 10 
p93 = 642;

pa1 = 411;       % 25
pa2 = -33 ;      % 8
% pa3 = 7227;      % 4
pa3 = 452;      % 4

pb1 = 29;        % 22
pb2 = -45;       % 9
pb3 = 372;     

pc1 = 33;        % 23
pc2 = -31;       % 9
pc3 = 309;       

pd1 = 7;         % 22  
pd2 = -35;       % 10
pd3 = 232; 

pe1 = 3;         % 22
pe2 = -642;      % 15
pe3 = 176; 

pf1 = 29;        % 27        
pf2 = -9;        % 10
pf3 = 119;      
%%
k1 = -0.001656;
b1 =  58.95;
k2 = -0.001452;
b2 = 55.19;
k3 = -0.001283;
b3 = 51.88;
k4 = -0.001142;
b4 = 48.94;
k5 = -0.001023;
b5 = 46.32;
k6 = -0.0009215;
b6 = 43.97;
k7 = -0.0008345;
b7 = 41.84;
k8 = -0.0007593;
b8 = 39.91;
%%
k1 = -217;        % 17
b1 =  7726694;
k2 = -6090;       % 22
b2 = 231483638;
k3 = -84;         % 16
b3 = 3400008;      
k4 = -299;        % 18
b4 = 12829327;
k5 = -67;         % 16
b5 = 3035627;
k6 = -3865;       % 22
b6 = 184423547;
k7 = -3500;       % 22
b7 = 175489679;       
k8 = -796;        % 20
b8 = 41848668;         
%%
P1_INT = [169,2517, 42807,339,41,90,639,14,583,411,29,33,7,3,29];
bits_P1 = [13,18,23,17,15,17,21,17,24,25,22,23,22,22,27];
P2_INT = [73, 1403,3677,18735,90,483,282,35,266,33,45,31,35,642,9];
P3_INT = [5371, 4158,3364,2687,2107,1724,1321,931,642,452,372,309,232,176,119];   
bits_P2 = [2,7,9,12,5,8,8,6,10,8,9,9,10,15,10];
K_INT = [217,6090,84,299,67,3865,3500,796];
bits_K = [17,22,16,18,16,22,22,20];
B_INT = [7726694,231483638,3400008,12829327,3035627,184423547,175489679,41848668];
%%
x_all = [256,335,427,512,669,833,999,1425,2000,3000,4040,4423,5844,7854,10181,17190];
[~,Q_picese] = size(x_all);
Q_picese = Q_picese-1;
x_all_linear = [17191,18403,19615,20827,22039, 23251,24463,25675,26887];
[~,L_picese] = size(x_all_linear);
L_picese = L_picese-1;

%%
div_table1 = [131072,104858,87381,74898,65536,58254,52429,47663,43691,40330,37449,34953,32768,30840,29127,27594,26214,24966,23831,22795,21845,20972,20165,19418,18725,18079,17476,16913,16384,15888,15420,14980,14564,14170,13797,13443,13107,12788,12483,12193,11916,11651,11398,11155,10923,10700,10486,10280,10082,9892,9709,9533,9362,9198,9039,8886,8738,8595,8456,8322,8192,8066,7944,7825,7710,7598,7490,7384,7282,7182,7085,6991,6899,6809,6722,6637,6554,6473,6394,6317,6242,6168,6096,6026,5958,5891,5825,5761,5699,5638,5578,5519,5461,5405,5350,5296,5243,5191,5140,5090,5041,4993,4946,4900,4855,4810,4766,4723,4681,4640,4599,4559,4520,4481,4443,4406,4369,4333,4297,4263,4228,4194,4161,4128,4096,4064,4033,4002,3972,3942,3913,3884,3855,3827,3799,3772,3745,3718,3692,3666,3641,3616,3591,3567,3542,3519,3495,3472,3449,3427,3404,3383,3361,3339,3318,3297,3277,3256,3236,3216,3197,3178,3158,3139,3121,3102,3084,3066,3048,3031,3013,2996,2979,2962,2945,2929,2913,2897,2881,2865,2849,2834,2819,2804,2789,2774,2759,2745,2731,2717,2703,2689,2675,2661,2648,2635,2621,2608,2595,2583,2570,2558,2545,2533,2521,2509,2497,2485,2473,2461,2450,2439,2427,2416,2405,2394,2383,2372,2362,2351,2341,2330,2320,2310,2300,2289,2280,2270,2260,2250,2241,2231,2222,2212,2203,2194,2185,2175,2166,2158,2149,2140,2131,2123,2114,2106,2097,2089,2081,2072,2064,2056,2048];
y = zeros(1,65536);
for x=4:256
    y(x)=div_table1(x-3);        
end
%%
for index = 1:Q_picese
    for x = x_all(index):x_all(index+1)
%         y(x) = int_B_picese(index)-bitshift((int_K_picese(index)*x+2^8),-9);    
        y(x) = bitshift(P1_INT(index)*(x^2)+2^(bits_P1(index)-1),-bits_P1(index)) - bitshift((P2_INT(index)*x+2^(bits_P2(index)-1)),-bits_P2(index))+P3_INT(index);
    end
end
%%
for index = 1:L_picese
    for x = x_all_linear(index):x_all_linear(index+1)
         y(x) =bitshift(B_INT(index)-K_INT(index)*x+2^(bits_K(index)-1),-bits_K(index));
    end
end
%%

Cx_all = [26888,28340,29960,31777,33826,36158,38837,41944,45591,49933,55189,61681];
Cy_all = [19,18,17,16,15,14,13,12,11,10,9,8];
CN_all = 11;
for index = 1:CN_all
    for x = Cx_all(index):Cx_all(index+1)-1
        y(x) = Cy_all(index);    
    end
end
for x = 61681:65536
    y(x) = Cy_all(end);
end
%%
%%
y_ = y;
x_ = 4:65536;
figure(8);plot(x_,y_(4:end),'red');hold on;
x0 = 4:65536;
y0 = round(4*2^17*(1./x0));
plot(x0,y0,'blue');

